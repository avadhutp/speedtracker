#!/usr/bin/env python

import requests
import sys


CRED = '\033[91m'
CEND = '\033[0m'

UNCHANGED_ENCRYPTION_KEY = 'YOUR_ENCRYPTED_KEY'

URL_ENCRYPTION_KEY = 'https://api.speedtracker.org/encrypt/{key}/'


def version_check():
	if sys.version_info < (2, 7):
		raise Exception('Must use python 2.7 or greater')


def make_call(url):
	response = requests.get(url)

	if(response.ok):
		return response.content

	raise Exception('Failed making the call to {url}: {err}'.format(
			url=url,
			err=str(response.status_code) + ' ' + response.content,
		))


def setup_encryption_key():
	key = ''
	while key == '':
		key = raw_input('Enter your encryption key: ')

	url = URL_ENCRYPTION_KEY.format(key=key)
	encryption_key = make_call(url)


def main():
	print '----Speedtracker setup----'
	try:
		version_check()
		setup_encryption_key()
	except Exception as e:
		print CRED + 'Error: {err}'.format(err=str(e)) + CEND


if __name__ == '__main__':
	main()